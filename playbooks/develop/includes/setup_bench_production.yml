---
  - hosts: localhost
    vars:
      bench_path: "/home/{{ ansible_user_id }}/frappe/frappe-bench"

    tasks:

    - name: Check ERPNext App exists
      stat: path="{{ bench_path }}/apps/erpnext"
      register: app

    - name: Get-app erpnext app
      command: bench get-app erpnext https://github.com/frappe/erpnext.git --branch {{ branch }}
      args:
        chdir: '{{ bench_path }}'
      when: app.stat.exists is defined and not app.stat.exists

    - name: Install erpnext app
      command: bench --site site1.local install-app erpnext
      args:
        chdir: '{{ bench_path }}'

    - name: Setup production
      become: yes
      become_user: root
      command: bench setup production {{ ansible_user_id }}
      args:
        chdir: '{{ bench_path }}'

    - name: Setup Sudoers
      become: yes
      become_user: root
      command: bench setup sudoers {{ ansible_user_id }}
      args:
        chdir: '{{ bench_path }}'
