language: python
dist: xenial

python:
  - "2.7"
  - "3.8"

install:
  - pip install --upgrade pip setuptools
  - pip install cffi cryptography flake8 ndg-httpsclient pyasn1 pycparser pyOpenSSL urllib3
  - sudo apt-get purge -y mysql-common mysql-server mysql-client
  - sudo apt-get install --only-upgrade -y git
  - sudo apt-get install hhvm && rm -rf /home/travis/.kiex/
  - mkdir -p ~/.bench
  - mkdir -p /tmp/.bench
  - flake8 . --count --select=E9,F63,F7,F822,F823 --show-source --statistics
  - TODO: (cclauss) add F821 to the testing when issue #856 is fixed
  - flake8 . --count --exit-zero --select=F821 --show-source --statistics
  - cp -r $TRAVIS_BUILD_DIR/* ~/.bench
  - cp -r $TRAVIS_BUILD_DIR/* /tmp/.bench

  # - sudo python $TRAVIS_BUILD_DIR/playbooks/install.py --user travis --run-travis --production --verbose
  # - sudo bash $TRAVIS_BUILD_DIR/install_scripts/setup_frappe.sh --skip-install-bench --mysql-root-password travis
  # - cd ~ && sudo python bench-repo/installer/install.py --only-dependencies

script:
  - cd ~
  - sudo pip install -e ~/.bench
  # - sudo python -m unittest bench.tests.test_setup_production.TestSetupProduction.test_setup_production_v6
  - sudo python -m unittest -v bench.tests.test_setup_production
